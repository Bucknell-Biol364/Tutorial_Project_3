---
title: "Group Project 1"
subtitle: "Biology 368/664 Bucknell University"
output: html_notebook
author: Prof. Ken Field
date: 9 Feb 2022
---
#### Project Outline #####
Data set we are using: https://data.cdc.gov/NCHS/Provisional-COVID-19-Deaths-by-Sex-and-Age/9bhg-hcku/data

Outline:
1) Introduction to class
2) Introduction to R (M)
    Define RMD vs Regular R
    Loading Data Set
    Load Packages
    Refer to glossary for a function/stats overview…
3) Explore Data Set (with function explanations) (A)
    Formulate a question
    Read data
    Check packaging 
    Run structure
    Look at top and bottom of data
    Check your n’s
4) Visualize Data Set
    Timeline vs death (M)
    Rank net deaths by state (B - Coding Done)
    West coast vs east coast (A)
    Male female histogram with death (A)
    Do older people have higher death rates than younger (B)
5) Statistical analysis (linear model?) to answer hypothesis
    Age groups and death 
    Linear Model (B)
6) Glossary of Functions and statistical analyses (A+B+M)

#### Project Content #####

INTRODUCTION:

INTRODUCTION TO R:

EXPLORATION OF DATASET:

##For the checking N's section potentially? (BT)
Checking if the total deaths match for each time division (by month, by year, total)
```{r}
sum(Covid_19.S.T.X.A$`COVID-19 Deaths`)
# All US total deaths (from the 50 states) from "by total" time catagory

Covid_19.S %>%
  filter(Sex == "All Sexes") %>%
  filter(Group == "By Year") %>%
  filter(`Age Group` == "All Ages") %>%
  summarize(Group, State, Sex,`Age Group`, `COVID-19 Deaths`) ->Covid_19.Deaths.byY
sum(Covid_19.Deaths.byY$`COVID-19 Deaths`)
#all US total deaths (from the 50 states) from "By Year" time category

Covid_19.S %>%
  filter(Sex == "All Sexes") %>%
  filter(Group == "By Month") %>%
  filter(`Age Group` == "All Ages") %>%
  summarize(Group, State, Sex,`Age Group`, `COVID-19 Deaths`) ->Covid_19.Deaths.byM
sum(Covid_19.Deaths.byM$`COVID-19 Deaths`, na.rm = TRUE)
#all US total deaths (from the 50 states) from "By Month" time catagory


```




VISUALIZATION OF DATASET AND VARIABLES OF INTEREST:

Renaming some columns in the dataframe because they have spaces and cause call issues:

```{r}
Covid_19<- rename(Covid_19, COVIDDeaths = "COVID-19 Deaths")
Covid_19<- rename(Covid_19, AgeGroup = "Age Group")
```

1. Plotting Data of COVID-19 Deaths from Pennsylvania (Total)
As there is such a large dataset, a specified dataframe with an area of interest is best for data visualization. Due to relevance, Pennsylvania is a good state to pick. Pennsylvania can be filtered from the larger dataset. 

```{r}
PennData<-filter(Covid_19, Sex!="NA" & Sex!="All Sexes" & State=="Pennsylvania")
```

This dataframe can be further refined using the filter function to explore COVID-19 deaths by Age, Group, and Year.

```{r}
CovidDataPennTotal<-filter(PennData, Group=="By Total" & AgeGroup!="All Ages" & AgeGroup!="Under 1 year" & AgeGroup!="1-4 years" & AgeGroup!="5-14 years" & AgeGroup!="15-24 years" & AgeGroup!="25-34 years" & AgeGroup!="35-44 years" & AgeGroup!="45-54 years" & AgeGroup!="55-64 years")
PennTotal<-ggplot(CovidDataPennTotal, aes(x = AgeGroup, y = COVIDDeaths)) +
  geom_point(aes(colour = factor(Sex)), 
             position = "jitter", 
             alpha = 0.8,
             size=0.05) +
  geom_smooth(formula = y ~ x,method='lm',aes(group = factor(Sex), 
                              colour = factor(Sex))) + 
  theme(legend.position = "right") + 
  ggtitle('Covid-19 Deaths by Age in Pennsylvania (Total) ') +
  labs(x= "Age Group", y= "COVID-19 Deaths") +
  theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust=0.5))
  theme_cowplot()
plot(PennTotal)
```

Plotting Data of COVID-19 Deaths from Pennsylvania (By Month)

```{r}
CovidDataPennMonth<-filter(PennData, Group=="By Month" & AgeGroup=="All Ages")
PennMonth<-ggplot(CovidDataPennMonth, aes(x = Month, y = COVIDDeaths)) +
  geom_point(aes(colour = factor(Year)), 
             position = "jitter", 
             alpha = 0.8,
             size=0.05) +
  geom_smooth(formula = y ~ x,method='lm',aes(group = factor(Year), 
                              colour = factor(Year))) + 
  theme(legend.position = "right") + 
  ggtitle('Covid-19 Deaths by Month in Pennsylvania ') +
  labs(x= "Month", y= "COVID-19 Deaths") +
  theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust=0.5))
  theme_cowplot()
plot(PennMonth)
```


General Data Exploration of Monthly COVID-19 Deaths Female/Male in Pennsylvania

```{r}
PM1<-ggplot(CovidDataPennMonth) +
  aes(x=Sex , y=COVIDDeaths) +
  geom_boxplot() +
  geom_jitter(width=.15, aes(color=Sex)) +
  ggtitle("Monthly Covid-19 Death vs Sex In Pennsylvania")+
  labs(x="Sex", y="COVID-19 Deaths")
  theme_cowplot() +
  theme(axis.text.x = element_text(angle = 0, vjust = 1, hjust=0.5))
  
PM2<-ggplot(CovidDataPennMonth) +
  aes(x = COVIDDeaths, fill = Sex) + 
  geom_density(alpha=.3) +
  xlab("Deaths") + ylab("Density") +
  labs(title="Density vs Monthly Covid-19 Deaths In Pennsylvania")
  theme_cowplot()
  
  
  
plot_grid(PM1,PM2, ncol=1)
```


Plotting Data of COVID-19 Deaths from Pennsylvania (By Year)

```{r}
CovidDataPennYear<-filter(PennData, Group=="By Year" & AgeGroup=="All Ages")
PennYear<-ggplot(CovidDataPennYear, aes(x = Year, y = COVIDDeaths)) +
  geom_point(aes(colour = factor(Sex)), 
             position = "jitter", 
             alpha = 0.8,
             size=0.05) +
  geom_smooth(formula = y ~ x,method='lm',aes(group = factor(Sex), 
                              colour = factor(Sex))) + 
  theme(legend.position = "right") + 
  ggtitle('Covid-19 Deaths by Month in Pennsylvania ') +
  labs(x= "Year", y= "COVID-19 Deaths") +
  theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust=0.5))
  theme_cowplot()
  
plot(PennYear)
```

2. West Coast vs East Coast COVID-19 Death Exploration 

Creation of dataframe with binary value (TRUE/FALSE) to sort East from West Coast Sates
```{r}
Covid_19%>%
  mutate(WC= State %in% c("Alaska","Arizona","Arkansas","California","Colorado","Hawaii","Idaho","Iowa","Kansas","Louisiana","Minnesota","Missouri","Oregon","South Dakota","Texas","Utah","Washington","Wyoming"))->Covid_19
```

West Coast vs East Coast COVID-19 Death by Sex

```{r}
CovidDataCoasts<-filter(Covid_19, Group=="By Total" & Sex!="All Sexes" & AgeGroup=="All Ages" & State!="United States" & State!="Puerto Rico")
Coast1<-ggplot(CovidDataCoasts) +
  aes(x=WC , y=COVIDDeaths) +
  geom_boxplot() +
  geom_jitter(width=.15, aes(color=Sex)) +
  ggtitle("Total Covid-19 Death vs East/West Coast") +
  labs(x="Coast", y="COVID-19 Deaths") +
  scale_x_discrete(labels = c('East', 'West')) +
  theme_cowplot() +
  theme(axis.text.x = element_text(angle = 0, vjust = 1, hjust=0.5))
plot(Coast1)
```
West Coast vs East Coast Deaths by Age Range

```{r}
CovidDataCoasts1<-filter(Covid_19, Group=="By Total" & AgeGroup!="All Ages" & AgeGroup!="Under 1 year" & AgeGroup!="1-4 years" & AgeGroup!="5-14 years" & AgeGroup!="15-24 years" & AgeGroup!="25-34 years" & AgeGroup!="35-44 years" & AgeGroup!="45-54 years" & AgeGroup!="55-64 years" & State!="United States" & State!="Puerto Rico", Sex!="Male" & Sex!="Female")
Coast2<-ggplot(CovidDataCoasts1, aes(x = AgeGroup, y = COVIDDeaths)) +
  geom_point(aes(colour = factor(WC)), 
             position = "jitter", 
             alpha = 0.8,
             size=0.05) +
  geom_smooth(formula = y ~ x,method='lm',aes(group = factor(WC), 
                              colour = factor(WC))) + 
  theme(legend.position = "right") + 
  ggtitle('Covid-19 Deaths by Age Group (Total) ') +
  labs(x= "Age Group", y= "COVID-19 Deaths") +
  theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust=0.5))
  theme_cowplot()
plot(Coast2)
```

```{r}
```

## Code for Visualizing "do older people have higher death rates than younger people?" (BT)
```{r}
library(dplyr)
Covid_19$`Age Group`<-as.factor(Covid_19$`Age Group`)
#age group = factor

Covid_19 %>%
  filter(State == "United States") %>%
  filter(Sex == "All Sexes") %>%
  filter(Group == "By Total") %>%
  summarize(State, Sex,`Age Group`, `COVID-19 Deaths`) -> Covid_19.Deaths.by.Age
#Isolates total Covid deaths in the country regardless of sex in its own Data set (filter and sumarize function example)

table(Covid_19.Deaths.by.Age$`Age Group`)
```

```{r}
Covid_19.Deaths.by.Age %>%
  filter(`Age Group` != "0-17 years" & `Age Group` != "All Ages" & `Age Group` != "55-64 years") ->Covid_19.Deaths.by.Age
#removing 0-17 years and All Ages and 55 - 64 years

Covid_19.Deaths.by.Age$`Age Group`<-recode_factor(Covid_19.Deaths.by.Age$`Age Group`, `Under 1 year` = "0-1 years", `1-4 years` = "01-4 years", `5-14 years` = "05-14 years")
 #renaming under 1 year to 0-1 year
table(Covid_19.Deaths.by.Age$`Age Group`)
#validating change
```
```{r}
library(ggplot2)
plot_Ds.by.Age<-ggplot(data=Covid_19.Deaths.by.Age, aes(x=`Age Group`, y=`COVID-19 Deaths`)) +
  geom_bar(stat="identity") +
  theme(axis.text.x = element_text(angle = 50, vjust = 0.7, hjust=0.5))
plot_Ds.by.Age
#plotting the data

```


## Code for Ranking net Deaths by State (BT)

```{r}
library(readr)
Covid_19<-read_csv("Data/Provisional_COVID-19_Deaths_by_Sex_and_Age.csv")
#^Can be deleted once we cement our dataset

library(dplyr)

#Looking at original dataset and ensuring State = coded as a factor
Covid_19$State<-as_factor(Covid_19$State)
nlevels(Covid_19$State)
summary(Covid_19$State)
#54 states, need to remove non-states

#Filter functions (one to be used as an example of != and one to be used as an example of ==)
Covid_19.S<-filter(Covid_19, State != "United States" & State != "District of Columbia" & State != "New York City" & State != "Puerto Rico")
Covid_19.S.T.X.A<-filter(Covid_19.S, Group == "By Total" & Sex == "All Sexes" & `Age Group` == "All Ages")

#ensuring filter process worked
table(Covid_19.S.T.X.A$State)
nlevels(Covid_19.S.T.X.A$State)

#data display
arrange(Covid_19.S.T.X.A,desc(`COVID-19 Deaths`))
```



STATISTICAL ANALYSIS:

GlOSSARY:




#### Project Details #####


This project will require you to develop a tutorial to teach Bucknell students how to use R for graphing and data analysis. 

## Target Audience

Discuss with your group the target audience for the tutorial. 
Examples could be one of the new core Biology classes, another 300-level course (not 364), or a research group. 

```{r echo=FALSE}

```


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r Load Libraries, include=FALSE}
# Load other packages here.
if (!require("datasauRus")) install.packages("datasauRus"); library(datasauRus)
if (!require("tidyverse")) install.packages("tidyverse"); library(tidyverse)
```

```{r}
library(readr)
Covid_19<-read_csv("./Data/Provisional_COVID-19_Deaths_by_Sex_and_Age.csv")
str(Covid_19)
```


## Grading

Each student will be expected to complete the following tasks to earn 85% of the points available for this assignment (21/25).

- Identify and obtain suitable dataset
- Use a Github repository and version control to collaborate on the project
- Spend 4-6 hours preparing, coding, and testing tutorial
  + Data exploration
  + Data visualization
  + Hypothesis testing
- Present tutorial in class
- Provide public archive suitable for sharing to students/faculty

Tutorials from previous classes can be viewed at our public github site: https://github.com/Bucknell-Biol364

Each group should use an *Acknowledgements* section to document the participation of each member and the collaboration within and between groups.

Additional credit will be awarded for providing assistance to other groups and for the development of a tutorial that goes beyond the minimal expectations listed above.



```{r}

```


```{r}

```

```{r}

```


```{r}

```



```{r}

```

# Acknowledgements


