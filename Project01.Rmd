---
title: "Group Project 3"
subtitle: "Biology 368/664 Bucknell University"
output: html_notebook
author: Prof. Ken Field
date: 9 Feb 2022
---
#### Project Outline #####
Data set we are using: https://data.cdc.gov/NCHS/Provisional-COVID-19-Deaths-by-Sex-and-Age/9bhg-hcku/data

Outline:
1) Introduction to class
2) Introduction to R (M)
    Define RMD vs Regular R
    Loading Data Set
    Load Packages
    Refer to glossary for a function/stats overview…
3) Explore Data Set (with function explanations) (A)
    Formulate a question
    Read data
    Check packaging 
    Run structure
    Look at top and bottom of data
    Check your n’s
4) Visualize Data Set
    Timeline vs death (M)
    Rank net deaths by state (B - Coding Done)
    West coast vs east coast (A)
    Male female histogram with death (A)
    Do older people have higher death rates than younger (B)
5) Statistical analysis (linear model?) to answer hypothesis
    Age groups and death 
    Linear Model (B)
6) Glossary of Functions and statistical analyses (A+B+M)

#### Project Content #####

INTRODUCTION TO EPIDEMIOLOGY:

Epidemiology is the "study of distribution and determinants of health related states among specified populations and the application of that study to control health problems" (A Dictionary of Epidemiology). The purpose of epidemiology in public health practice is to: (1) discover and analyze agents that affect heath, (2) determining causes of illness, disability, and death, (3) identification of populations at risk, and (4) develop effective programs and services to to improve population health. Many epidemiologists solve health problems through a formal scientific approach that includes data collection, assessment, hypothesis testing, and action.  

The employment of epidemiology has been notably publicized by the COVID-19 epidemic. As many people have been impacted by the virus in various capacities, this has sparked curiosity into how professionals identify, measure, and represent the epidemiology of such infections. In this R tutorial, we will assume the role of an epidemiologist and conduct a formal scientific method using a COVID-19 dataset provided by the CDC.

At the conclusion of this project, the following should be accomplished:
  1. Relate epidemiology data collection to data science/analysis
  2. Carry out scientific method
      a. Perform an exploration of dataset using R 
      b. Perform basic data analysis using R
      c. Draw conclusions from analysis
  
INTRODUCTION TO R:

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r Load Libraries, include=FALSE}
# Load other packages here.
if (!require("tidyverse")) install.packages("tidyverse"); library(tidyverse)
if (!require("dplyr")) install.packages("dplyr"); library(dplyr)
if (!require("ggplot2")) install.packages("ggplot2"); library(ggplot2)
if (!require("readr")) install.packages("readr"); library(readr)
if (!require("cowplot")) install.packages("cowplot"); library(cowplot)
if (!require("vioplot")) install.packages("vioplot"); library(vioplot)
if (!require("car")) install.packages("car"); library(car)
```

```{r Load in Data Set}
Covid_19<-read_csv("./Data/Provisional_COVID-19_Deaths_by_Sex_and_Age.csv")
```

Renaming any categories that have a space in them. RStudio does not like spaces and therefore it is easier to just rename them. 
```{r}
# Below is a very handy way to eliminate those annoying spaces in the column names!
names(Covid_19) <- make.names(names(Covid_19))
```


EXPLORATION OF DATASET:

When a dataset is uploaded, there is an informal checklist to complete before visualization and anlaysis. One should become familiar with the elements in the dataset. The "Covid_19" dataframe provides epidemiological data that is inclusive of: 
  1.Data "as of" date
  2.Start dates of data collection
  3.End dates of data collection
  4.Grouped data by month, year, or total
  5.Year of collected data (if applicable)
  6.Month of data collection (if applicable)
  7.State of data collection, or the entire United States
  8.Sex divided into male, female, or total
  9.Varied age groups or total collections 
  10.COVID-19 Deaths 
  11.Total Deaths
  12.Pneumonia Deaths
  13.Pneumonia Deaths and COVID-19 Deaths
  14.Influenza Deaths
  15.Pneumonia, Influenza, or COVID-19 Deaths
  16.Footnotes
These variables are all divided into their own column. Just by initially looking through these variables, one can notice some complexities that should be noted. This dataframe includes both summed total data and individual unit data. Thus, both broad and narrow analysis can be made using the dataset. For example, could could compare total deaths in the United States by age group, or one could look at total deaths by month, sex, and age group in a particular state. Caution should be used, however, when filtering the data when conducting an analysis to answer a particular question. Finally, for this dataframe, there are 82620 observations that can be inferred as points of collection. 

##Forumating a Question: 

Once the variables of the dataframe have been assessed, one should formulate a question. Assuming this dataframe was given to an epidemiologist, they may be particularity interested in the time, state, sex, and COVID-19 Death  variables. Formulating a question at the beginning of data analysis can be limit extraneous paths taken with a large dataset. A precise question and/or hypothesis can eliminate unnecessary variables.

The hypothesis(s) we should be interested in for this R tutorial are: 
1. 
2.

##Read Data:

The next step in exploratory data analysis is to read in a portion of data. The purpose of this task is to determine in the data is messy and should be cleaned. Messy data with often times be orderly, have missing values, and is not suitable for immediate data visualization. As the data provided was from the CDC, we can expect relatively "clean" data. 

```{r}
library(readr)
Covid_19 <- read_csv("./Data/Provisional_COVID-19_Deaths_by_Sex_and_Age.csv") 
summary(Covid_19)
```

The readr package is used here because it can read and analyze large dataframes fast. The summary of the "Covid-19" dataframe was performed to get a general idea of what type of data is included in the data frame (character, interger, numeric) and it also preforms a basic analysis of the numeric data by providing quartile ranges.

Here, we can also note that there are spaces in the some of the column names. Space often interfere with coding functions, and should be taken out for convenience. We can remove the spaces in the columns of interest by using the rename function. The general struction of the rename function is as follows: dataframe (can make new or use original)<-rename(dataframe change, new column name="column with spaces)

```{r}
Covid_19<- rename(Covid_19, COVIDDeaths = "COVID-19 Deaths")
Covid_19<- rename(Covid_19, AgeGroup = "Age Group")
```

##Check Packaging

Next, the packaging of the dataframe should be assessed. This validates that the dataframe is complete and is properly loaded. This can be complete using simple R commands. We can look at the number of columns and rows that the dataframe has. 

```{r}
ncol(Covid_19)
nrow(Covid_19)
```

As the output of this code chuck matches the expected number of variables and observation, it can be assumed that the dataframe was uploaded correctly. 

##Run str()

Another general exploration tool that should be completed before analysis is running the structure of the dataframe. The output of this command replicates some knowledge we already have, however, it is another clean visual of the composition of the data and method to catch potential problems before analysis. 

```{r}
str(Covid_19)
```

As there are no apparent issues, we can move to the next step in the checklsit.

##Check Top and Bottom of Data

Assessing the beginning and end of the dataframe is a useful tool to assure the data was loaded in property, the data is properly formatted, and that all expected data is present. Should dates be present in the dataframe, this technique is useful to check the ordering of them.  

The "Covid_19" dataframe has dates and the ordering should be evaluated. This can be completed via the head and tail R commands. The structure of this commands is as follows: head/tail(dataframe[, c(column:column, #rows)]).


DESCRIBE BRACKETS and then "," and c(range)

```{r}
head(Covid_19[, c(1:3, 10)])
tail(Covid_19[, c(1:3, 10)])
```

By looking at the start dates, we can see that the dataframe is logical. At the head (first ten rows), the data collection start date began in January of 2020. At the tail of the dataframe (last ten rows), the start date began in February of 2022. 

Additionally, the tail command can be useful for identifying extraneous values or information placed at the end of the dataframe. 

##For the checking N's section potentially? (BT)

For data exploration, it is helpful to identify landmarks within a dataframe that can be used to check against the data being evaluated. This can be number a number of ways, but simply, a table can be made. As the Covid-19 dataframe uses counts people, this variable can be used to check ot mkae sure the expected amount of observations are present. The same can be done by evaluating the "State" variable.

The function table can be utilized in R. The structure of the command is as follows: table(dataframe$variable). The dollar sign here is used to evaluate a particular viaribale from a particular dataframe. 

```{r}
table(Covid_19$Sex)
table(Covid_19$State)
```

By counting the number of observations from each variable category (whether sex or state), the number equals the amount of observations present in the dataframe. By looking at the states, however, we note that Puerto Rico and District of Columbia are included on the dataset. It is up to the epidemiologist, in later sections, to determine whether these locations should be included in analysis. 




Checking if the total deaths match for each time division (by month, by year, total)
```{r}
sum(Covid_19.S.T.X.A$`COVID-19 Deaths`)
# All US total deaths (from the 50 states) from "by total" time catagory

Covid_19.S %>%
  filter(Sex == "All Sexes") %>%
  filter(Group == "By Year") %>%
  filter(`Age Group` == "All Ages") %>%
  summarize(Group, State, Sex,`Age Group`, `COVID-19 Deaths`) ->Covid_19.Deaths.byY
sum(Covid_19.Deaths.byY$`COVID-19 Deaths`)
#all US total deaths (from the 50 states) from "By Year" time category

Covid_19.S %>%
  filter(Sex == "All Sexes") %>%
  filter(Group == "By Month") %>%
  filter(`Age Group` == "All Ages") %>%
  summarize(Group, State, Sex,`Age Group`, `COVID-19 Deaths`) ->Covid_19.Deaths.byM
sum(Covid_19.Deaths.byM$`COVID-19 Deaths`, na.rm = TRUE)
#all US total deaths (from the 50 states) from "By Month" time catagory


```



##Other Checks to Consider

After an initial check over the dataframe has been complete, there are other factors to consider. For this purpose of this R tutorial, they will not be completed, but rather highlighted as things to be consider when conducting ones own data analysis. The first additional rule of thumb is to validate your data with an external source. The CDC is very reliable, but say you had your own data. One would want to compare observations and numeric variables against another reliable source to conclude the absence of erroneous data. Furthermore, it may be beneficial to try to answer your question/hypothesis in the easiest way possible. Say your question simply asks which state had the most COVID-19 death in 2020. The data can simply be filtered and does not need to be further explored. The solution to those questions, however, should be challenged if possible. Factors such as some states not reporting data could be an issue (just as an example, not in this dataframe). The purpose of this section us to riase the point that not all questions need a deep dive into data analysis, rather, just a basic R exploration. Questions that compare variables are look at causality, however, do require a lengthier analysis. 


VISUALIZATION OF DATASET AND VARIABLES OF INTEREST:

1. Plotting Data of COVID-19 Deaths per year and month. 
This is a great way to start looking at the data set. Here we can get a visualization of how the data is spread out over years and then narrow in per month. 
This first plot shows COVID-19 Deaths per year.
```{r}
ggplot(Covid_19) +
  geom_jitter() + 
  aes(x= Year, y= COVID.19.Deaths) + 
    ggtitle("Covid 19 Deaths per Year") + 
  xlab("Year") + 
  ylab("Covid 19 Deaths") + 
  geom_point() + 
  theme_cowplot()
```
Here we can visualize if there is a difference in COVID-19 Deaths per month
```{r}
ggplot(Covid_19) +
  geom_jitter() + 
  aes(x= Month, y= COVID.19.Deaths) + 
    ggtitle("Covid 19 Deaths per Year") + 
  xlab("Month") + 
  ylab("Covid 19 Deaths") + 
  geom_point() + 
  theme_cowplot()
```

2. Plotting Data of COVID-19 Deaths from Pennsylvania (Total)
As there is such a large dataset, a specified dataframe with an area of interest is best for data visualization. Due to relevance, Pennsylvania is a good state to pick. Pennsylvania can be filtered from the larger dataset. 

```{r}
PennData<-filter(Covid_19, Sex!="NA" & Sex!="All Sexes" & State=="Pennsylvania")
```

This dataframe can be further refined using the filter function to explore COVID-19 deaths by Age, Group, and Year.

```{r}
CovidDataPennTotal<-filter(PennData, Group=="By Total" & AgeGroup!="All Ages" & AgeGroup!="Under 1 year" & AgeGroup!="1-4 years" & AgeGroup!="5-14 years" & AgeGroup!="15-24 years" & AgeGroup!="25-34 years" & AgeGroup!="35-44 years" & AgeGroup!="45-54 years" & AgeGroup!="55-64 years")
PennTotal<-ggplot(CovidDataPennTotal, aes(x = AgeGroup, y = COVIDDeaths)) +
  geom_point(aes(colour = factor(Sex)), 
             position = "jitter", 
             alpha = 0.8,
             size=0.05) +
  geom_smooth(formula = y ~ x,method='lm',aes(group = factor(Sex), 
                              colour = factor(Sex))) + 
  theme(legend.position = "right") + 
  ggtitle('Covid-19 Deaths by Age in Pennsylvania (Total) ') +
  labs(x= "Age Group", y= "COVID-19 Deaths") +
  theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust=0.5))
  theme_cowplot()
plot(PennTotal)
```

Plotting Data of COVID-19 Deaths from Pennsylvania (By Month)

```{r}
CovidDataPennMonth<-filter(PennData, Group=="By Month" & AgeGroup=="All Ages")
PennMonth<-ggplot(CovidDataPennMonth, aes(x = Month, y = COVIDDeaths)) +
  geom_point(aes(colour = factor(Year)), 
             position = "jitter", 
             alpha = 0.8,
             size=0.05) +
  geom_smooth(formula = y ~ x,method='lm',aes(group = factor(Year), 
                              colour = factor(Year))) + 
  theme(legend.position = "right") + 
  ggtitle('Covid-19 Deaths by Month in Pennsylvania ') +
  labs(x= "Month", y= "COVID-19 Deaths") +
  theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust=0.5))
  theme_cowplot()
plot(PennMonth)
```

General Data Exploration of Monthly COVID-19 Deaths Female/Male in Pennsylvania

```{r}
PM1<-ggplot(CovidDataPennMonth) +
  aes(x=Sex , y=COVIDDeaths) +
  geom_boxplot() +
  geom_jitter(width=.15, aes(color=Sex)) +
  ggtitle("Monthly Covid-19 Death vs Sex In Pennsylvania")+
  labs(x="Sex", y="COVID-19 Deaths")
  theme_cowplot() +
  theme(axis.text.x = element_text(angle = 0, vjust = 1, hjust=0.5))
  
PM2<-ggplot(CovidDataPennMonth) +
  aes(x = COVIDDeaths, fill = Sex) + 
  geom_density(alpha=.3) +
  xlab("Deaths") + ylab("Density") +
  labs(title="Density vs Monthly Covid-19 Deaths In Pennsylvania")
  theme_cowplot()
  
  
plot_grid(PM1,PM2, ncol=1)
```

Plotting Data of COVID-19 Deaths from Pennsylvania (By Year)

```{r}
CovidDataPennYear<-filter(PennData, Group=="By Year" & AgeGroup=="All Ages")
PennYear<-ggplot(CovidDataPennYear, aes(x = Year, y = COVIDDeaths)) +
  geom_point(aes(colour = factor(Sex)), 
             position = "jitter", 
             alpha = 0.8,
             size=0.05) +
  geom_smooth(formula = y ~ x,method='lm',aes(group = factor(Sex), 
                              colour = factor(Sex))) + 
  theme(legend.position = "right") + 
  ggtitle('Covid-19 Deaths by Month in Pennsylvania ') +
  labs(x= "Year", y= "COVID-19 Deaths") +
  theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust=0.5))
  theme_cowplot()
  
plot(PennYear)
```

3. West Coast vs East Coast COVID-19 Death Exploration 

Creation of dataframe with binary value (TRUE/FALSE) to sort East from West Coast Sates
```{r}
Covid_19%>%
  mutate(WC= State %in% c("Alaska","Arizona","Arkansas","California","Colorado","Hawaii","Idaho","Iowa","Kansas","Louisiana","Minnesota","Missouri","Oregon","South Dakota","Texas","Utah","Washington","Wyoming"))->Covid_19
```

West Coast vs East Coast COVID-19 Death by Sex

```{r}
CovidDataCoasts<-filter(Covid_19, Group=="By Total" & Sex!="All Sexes" & AgeGroup=="All Ages" & State!="United States" & State!="Puerto Rico")
Coast1<-ggplot(CovidDataCoasts) +
  aes(x=WC , y=COVIDDeaths) +
  geom_boxplot() +
  geom_jitter(width=.15, aes(color=Sex)) +
  ggtitle("Total Covid-19 Death vs East/West Coast") +
  labs(x="Coast", y="COVID-19 Deaths") +
  scale_x_discrete(labels = c('East', 'West')) +
  theme_cowplot() +
  theme(axis.text.x = element_text(angle = 0, vjust = 1, hjust=0.5))
plot(Coast1)
```
West Coast vs East Coast Deaths by Age Range

```{r}
CovidDataCoasts1<-filter(Covid_19, Group=="By Total" & AgeGroup!="All Ages" & AgeGroup!="Under 1 year" & AgeGroup!="1-4 years" & AgeGroup!="5-14 years" & AgeGroup!="15-24 years" & AgeGroup!="25-34 years" & AgeGroup!="35-44 years" & AgeGroup!="45-54 years" & AgeGroup!="55-64 years" & State!="United States" & State!="Puerto Rico", Sex!="Male" & Sex!="Female")
Coast2<-ggplot(CovidDataCoasts1, aes(x = AgeGroup, y = COVIDDeaths)) +
  geom_point(aes(colour = factor(WC)), 
             position = "jitter", 
             alpha = 0.8,
             size=0.05) +
  geom_smooth(formula = y ~ x,method='lm',aes(group = factor(WC), 
                              colour = factor(WC))) + 
  theme(legend.position = "right") + 
  ggtitle('Covid-19 Deaths by Age Group (Total) ') +
  labs(x= "Age Group", y= "COVID-19 Deaths") +
  theme(axis.text.x = element_text(angle = 90, vjust = 1, hjust=0.5))
  theme_cowplot()
plot(Coast2)
```

```{r}
```

## Code for Visualizing "do older people have higher death rates than younger people?" (BT)
```{r}
library(dplyr)
Covid_19$`Age Group`<-as.factor(Covid_19$`Age Group`)
#age group = factor

Covid_19 %>%
  filter(State == "United States") %>%
  filter(Sex == "All Sexes") %>%
  filter(Group == "By Total") %>%
  summarize(State, Sex,`Age Group`, `COVID-19 Deaths`) -> Covid_19.Deaths.by.Age
#Isolates total Covid deaths in the country regardless of sex in its own Data set (filter and sumarize function example)

table(Covid_19.Deaths.by.Age$`Age Group`)
```

```{r}
Covid_19.Deaths.by.Age %>%
  filter(`Age Group` != "0-17 years" & `Age Group` != "All Ages" & `Age Group` != "55-64 years") ->Covid_19.Deaths.by.Age
#removing 0-17 years and All Ages and 55 - 64 years

Covid_19.Deaths.by.Age$`Age Group`<-recode_factor(Covid_19.Deaths.by.Age$`Age Group`, `Under 1 year` = "0-1 years", `1-4 years` = "01-4 years", `5-14 years` = "05-14 years")
 #renaming under 1 year to 0-1 year
table(Covid_19.Deaths.by.Age$`Age Group`)
#validating change
```
```{r}
library(ggplot2)
plot_Ds.by.Age<-ggplot(data=Covid_19.Deaths.by.Age, aes(x=`Age Group`, y=`COVID-19 Deaths`)) +
  geom_bar(stat="identity") +
  theme(axis.text.x = element_text(angle = 50, vjust = 0.7, hjust=0.5))
plot_Ds.by.Age
#plotting the data

```


## Code for Ranking net Deaths by State (BT)

```{r}
library(readr)
Covid_19<-read_csv("Data/Provisional_COVID-19_Deaths_by_Sex_and_Age.csv")
#^Can be deleted once we cement our dataset

library(dplyr)

#Looking at original dataset and ensuring State = coded as a factor
Covid_19$State<-as_factor(Covid_19$State)
nlevels(Covid_19$State)
summary(Covid_19$State)
#54 states, need to remove non-states

#Filter functions (one to be used as an example of != and one to be used as an example of ==)
Covid_19.S<-filter(Covid_19, State != "United States" & State != "District of Columbia" & State != "New York City" & State != "Puerto Rico")
Covid_19.S.T.X.A<-filter(Covid_19.S, Group == "By Total" & Sex == "All Sexes" & `Age Group` == "All Ages")

#ensuring filter process worked
table(Covid_19.S.T.X.A$State)
nlevels(Covid_19.S.T.X.A$State)

#data display
arrange(Covid_19.S.T.X.A,desc(`COVID-19 Deaths`))
```



STATISTICAL ANALYSIS:

GlOSSARY:




#### Project Details #####


This project will require you to develop a tutorial to teach Bucknell students how to use R for graphing and data analysis. 

## Target Audience

Discuss with your group the target audience for the tutorial. 
Examples could be one of the new core Biology classes, another 300-level course (not 364), or a research group. 

```{r echo=FALSE}

```






## Grading

Each student will be expected to complete the following tasks to earn 85% of the points available for this assignment (21/25).

- Identify and obtain suitable dataset
- Use a Github repository and version control to collaborate on the project
- Spend 4-6 hours preparing, coding, and testing tutorial
  + Data exploration
  + Data visualization
  + Hypothesis testing
- Present tutorial in class
- Provide public archive suitable for sharing to students/faculty

Tutorials from previous classes can be viewed at our public github site: https://github.com/Bucknell-Biol364

Each group should use an *Acknowledgements* section to document the participation of each member and the collaboration within and between groups.

Additional credit will be awarded for providing assistance to other groups and for the development of a tutorial that goes beyond the minimal expectations listed above.



```{r}

```


```{r}

```

```{r}

```


```{r}

```



```{r}

```

# Acknowledgements


