---
title: "BT_sections"
author: "Ben Travis"
date: "2/15/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
if (!require("tidyverse")) install.packages("tidyverse"); library(tidyverse)
if (!require("readr")) install.packages("readr"); library(readr)
if (!require("dplyr")) install.packages("dplyr"); library(dplyr)
```

```{r}
library(readr)
Covid_19<-read_csv("Data/Provisional_COVID-19_Deaths_by_Sex_and_Age.csv")
str(Covid_19)
getwd()
```

## Code for Ranking net Deaths by State

```{r}
library(dplyr)

#Looking at original dataset and ensuring State = coded as a factor
Covid_19$State<-as_factor(Covid_19$State)
nlevels(Covid_19$State)
summary(Covid_19$State)
#54 states, need to remove non-states

#Filter functions (one to be used as an example of != and one to be used as an example of ==)
Covid_19.S<-filter(Covid_19, State != "United States" & State != "District of Columbia" & State != "New York City" & State != "Puerto Rico")
Covid_19.S.T.X.A<-filter(Covid_19.S, Group == "By Total" & Sex == "All Sexes" & `Age Group` == "All Ages")

#ensuring filter process worked
table(Covid_19.S.T.X.A$State)
nlevels(Covid_19.S.T.X.A$State)

#data display
arrange(Covid_19.S.T.X.A,desc(`COVID-19 Deaths`))
```



library(dplyr)
Covid_19.AT.S4.B %>%
  mutate(EC = State %in% c("Alabama", "New York")) -> Covid_19.AT.S4.B


## Code for Visualizing "do older people have higher death rates than younger people?"
```{r}
library(dplyr)
Covid_19$`Age Group`<-as.factor(Covid_19$`Age Group`)
#age group = factor

Covid_19 %>%
  filter(State == "United States") %>%
  filter(Sex == "All Sexes") %>%
  filter(Group == "By Total") %>%
  summarize(State, Sex,`Age Group`, `COVID-19 Deaths`) -> Covid_19.Deaths.by.Age
#Isolates total Covid deaths in the country regardless of sex in its own Data set (filter and sumarize function example)

table(Covid_19.Deaths.by.Age$`Age Group`)
```

```{r}
Covid_19.Deaths.by.Age %>%
  filter(`Age Group` != "0-17 years" & `Age Group` != "All Ages" & `Age Group` != "55-64 years") ->Covid_19.Deaths.by.Age
#removing 0-17 years and All Ages and 55 - 64 years

Covid_19.Deaths.by.Age$`Age Group`<-recode_factor(Covid_19.Deaths.by.Age$`Age Group`, `Under 1 year` = "0-1 years", `1-4 years` = "01-4 years", `5-14 years` = "05-14 years")
 #renaming under 1 year to 0-1 year
table(Covid_19.Deaths.by.Age$`Age Group`)
#validating change
```
```{r}
library(ggplot2)
plot_Ds.by.Age<-ggplot(data=Covid_19.Deaths.by.Age, aes(x=`Age Group`, y=`COVID-19 Deaths`)) +
  geom_bar(stat="identity") +
  theme(axis.text.x = element_text(angle = 50, vjust = 0.7, hjust=0.5))
plot_Ds.by.Age
#plotting the data

```



## Checking if the total deals match for each time division (by month, by year, total)

```{r}
sum(Covid_19.S.T.X.A$`COVID-19 Deaths`)
# All US total deaths (from the 50 states) from "by total" time catagory

Covid_19.S %>%
  filter(Sex == "All Sexes") %>%
  filter(Group == "By Year") %>%
  filter(`Age Group` == "All Ages") %>%
  summarize(Group, State, Sex,`Age Group`, `COVID-19 Deaths`) ->Covid_19.Deaths.byY
sum(Covid_19.Deaths.byY$`COVID-19 Deaths`)
#all US total deaths (from the 50 states) from "By Year" time category

Covid_19.S %>%
  filter(Sex == "All Sexes") %>%
  filter(Group == "By Month") %>%
  filter(`Age Group` == "All Ages") %>%
  summarize(Group, State, Sex,`Age Group`, `COVID-19 Deaths`) ->Covid_19.Deaths.byM
sum(Covid_19.Deaths.byM$`COVID-19 Deaths`, na.rm = TRUE)
#all US total deaths (from the 50 states) from "By Month" time catagory


```




VISUALIZATION OF DATASET AND VARIABLES OF INTEREST:

1. Plotting Data of COVID-19 Deaths by year and month. 

This is a great way to start looking at the data set. Here we can get a visualization of how the data is spread out over years and then narrow in per month. 

This first plot shows COVID-19 Deaths per year. 
```{r}
Covid_19$Year<-as.numeric(Covid_19$Year)
ggplot(Covid_19) +
  geom_jitter() + 
  aes(x= Year, y= COVID.19.Deaths) + 
    ggtitle("Covid 19 Deaths per Year") + 
  xlab("Year") + 
  ylab("Covid 19 Deaths") + 
  geom_point() + 
  theme_cowplot()
```
###We actually should get rid of the .5 notation if possible ot makes it look like the data isnt reported yearly. I tried to do this by making it a factor (only thing dif above) and this was the result. This is because all the "by total" groups = NAs, which we could just say in a sentence to ignore, but also I think by doing it like this we are accidentally graphing the month Values too... (BT comment)  we might want to check that warning too


ggplot(Covid_19 = na.omit(Covid_19)) +
  geom_jitter() + 
  aes(x= Covid_19$Year, y= Covid_19$Covid.19.Deaths) + 
  ggtitle("Covid 19 Deaths per Year") + 
  xlab("Year") + 
  ylab("Covid 19 Deaths") + 
  geom_point() + 
  theme_cowplot()
###^my attempt to fix it, but it didn't work

Here we can visualize if there is a difference in COVID-19 Deaths per month
```{r}
Covid_19$Month<-as.factor(Covid_19$Month)
ggplot(Covid_19) +
  geom_jitter() + 
  aes(x= Month, y= COVID.19.Deaths) + 
    ggtitle("Covid 19 Deaths per Year") + 
  xlab("Month") + 
  ylab("Covid 19 Deaths") + 
  geom_point()+
  theme_cowplot()
```



lm(Response/Dependent Variable ~ Predictor/Independent Variable, data=data.frame)

Notice that the product of this function is assigned the identity "lmEvsW" for East vs. West Coast. This analysis is performed using the lmCovidDataCoasts dataset, with all sex, by total, All Age observations, excluding the "States" of "United States", "New York City", and "Peurto Rico". The 51 observations are present within the data frame are explained by 1 per "state" for 51 "states" (the traditional 50 states + the District of Columbia). The summary(lmEvsW)
plot(lmEvsW) functions should always be ran in tandem with the execution of a linear model in order to ensure the model can be assessed. Briefly look at the output below after running the code chunk, and then follow the text below the output describing the results of a linear model.

```{r}
lmCovidDataCoasts<-filter(Covid_19, Group=="By Total" & Sex=="All Sexes" & Age.Group=="All Ages" & State!="United States" & State!="Puerto Rico", State!= "New York City" )
lmEvsW <- lm(COVID.19.Deaths ~ WC, data=lmCovidDataCoasts)
summary(lmEvsW)
plot(lmEvsW)
```

The assumptions required to perform a linear model include the following:
1) Linearity: The relationship between X and the mean of Y is linear, or the X variable is categorical. In this case, we are comparing East Coast vs West Coast binomial categories, so we don't have to check for linearity. In fact, we are only going to be analyzing categorical X variables for the remainder of this tutorial, so this constraint is not relevant to our analysis.

2) Homoscedasticity: The variance of the residuals is random for each X value. Select the second output frame above. Because we are looking at a categorical variable, our X values become these 2 categories (east and west coast). Notice that the distribution of residuals is fairly consistent across both X values.

3) Independence: Observations are independent of each other. We can determine from intuition that the number of Covid-19 deaths are not dependent on the State name. It is still possible that State may have an effect on Covid-19 deaths, but this is different than "state" being dependent on Covid-19 deaths.

4) Normality: For any fixed value of X, Y is normally distributed. Select the 3rd output frame. This can be evaluated from a qqplot, which you likely remember from your statistics course. If the points are distributed along the line, then the Y values are normally distributed for each X value.

Notice that we do not have normal distribution for this analysis. This does not make our linear model entirely not compatible with the data, but does require that we interpret the results with caution. 

Interpreting Significance:
Select the first output frame above. Theoretically what this linear model is doing is fitting a horizontal line through the weighted mean Y value for one category of X (call this X1). Then, the linear model is comparing the weighted mean Y value for X1 to the weighted mean Y value of category X2 and determining the probability (p value) that these two weighted mean values come from the same population. A linear model is capible of comparing a number of categorical variables like this, making it very useful.

Look under the "Coefficients" detection of output frame 1. "(Intercept)" shows the baseline X value that the rest are being compared to. RStudio automatically selects the baseline category for comparison by alphabetical order. Although it is not explicitly stated, this category above is "WCFALSE", and WCTRUE is being compared to this baseline. The number under the "Estimate" column for "(Intercept)" represents the the weighted average number of deaths per East Coast (or WCFALSE) State, which in this case is 16850.2 deaths. 

Now, looking at the WCTRUE row of code, notice the number under the "Estimate" column is 303.8 deaths. Remember, everything is in comparison to the baseline category (WCFALSE), so this is actually saying that states on the west coast have weighted average number of deaths per state that is higher by 303.8 deaths. However, by looking under the "Pr(>|t|)" (or p value) column in the WCTRUE row, we can see that this difference in weighted average is no where near close to being significant (p=0.956), and we can conclude that the number of Covid-19 deaths do not differ significantly by coast. 


2. We hypothesize that there will be more COVID-19 deaths reported for older individuals in PA.

```{r}

PennData$Age.Group<-recode_factor(PennData$Age.Group, `Under 1 year` = "0-1 years", `1-4 years` = "01-4 years", `5-14 years` = "05-14 years")
PennData%>%
  filter(Group=="By Month" & Year!="2022") %>%
  filter(Age.Group != "0-17 years" & Age.Group != "All Ages" & Age.Group != "50-64 years") ->Covid_19PA.OldvsY

lmOvsY <- lm(COVID.19.Deaths ~ Age.Group, data=Covid_19PA.OldvsY)
summary(lmOvsY)
plot(lmOvsY)
```

3. We hypothesize that there will be no difference in COVID-19 deaths between the to genders in PA.

```{r}
shapiro.test(CovidDataPennMonth$COVID.19.Deaths)
shapiro.test(CovidDataCoasts1$COVID.19.Deaths)
shapiro.test(CovidDataCoasts$COVID.19.Deaths)

CovidDataPennMonth1<-filter(PennData, Group=="By Month" & Age.Group=="All Ages" & Year!="2022")
lmCDM1 <- lm(COVID.19.Deaths ~ Sex, data=CovidDataPennMonth1)
summary(lmCDM1)
plot(lmCDM1)
```



GlOSSARY:



###Should the below contents be at the beginning (BT comment)

#### Project Details #####


This project will require you to develop a tutorial to teach Bucknell students how to use R for graphing and data analysis. 

## Target Audience

Discuss with your group the target audience for the tutorial. 
Examples could be one of the new core Biology classes, another 300-level course (not 364), or a research group. 

```{r echo=FALSE}

```





## Grading

Each student will be expected to complete the following tasks to earn 85% of the points available for this assignment (21/25).

- Identify and obtain suitable dataset
- Use a Github repository and version control to collaborate on the project
- Spend 4-6 hours preparing, coding, and testing tutorial
  + Data exploration
  + Data visualization
  + Hypothesis testing
- Present tutorial in class
- Provide public archive suitable for sharing to students/faculty

Tutorials from previous classes can be viewed at our public github site: https://github.com/Bucknell-Biol364

Each group should use an *Acknowledgements* section to document the participation of each member and the collaboration within and between groups.

Additional credit will be awarded for providing assistance to other groups and for the development of a tutorial that goes beyond the minimal expectations listed above.


# Acknowledgements





